<!DOCTYPE html>
<html lang="pt-BR">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Buscar imagem por Cod/EAN</title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
   </head>
   <body>
      <input onclick="this.select()" name="cod"  type="text" maxlength="14" size="20" id="myInput" placeholder="Código/EAN" style="border: solid blue 1px"/>
      <button id="buscar" type="button" onclick="loadDoc()">Buscar imagem do produto</button>
      <p>
         <a class="class" href="" id="nomepro" target="_blank"></a>
      </p>
      <style>
         th{ 
         color:#fff;
         }
      </style>
      <table class="table table-striped">
         <tr  class="bg-info">
            <th>Tam.</th>
            <th>Cod</th>
            <th>Ean</th>
            <th>Sem Desc.</th>
            <th>Preço</th>
         </tr>
         <tbody id="myTable">
         </tbody>
      </table>
      <img id="myimage" width="40%" height="auto%"/>
      <img id="myimageLarge" width="100%" height="auto%"/>
      <img id="myimage2" width="100%" height="auto%"/>
      <img id="myimage3" width="100%" height="auto%"/>
      <img id="myimage4" width="100%" height="auto%"/>
      <img id="myimage5" width="100%" height="auto%"/>
      <img id="myimage6" width="100%" height="auto%"/>
      <img id="myimage7" width="100%" height="auto%"/>
      <img id="myimage8" width="100%" height="auto%"/>
      <img id="myimage9" width="100%" height="auto%"/>
      <img id="myimage10" width="100%" height="auto%"/>
      <p></p>
      <script>
         //https://edimarpcosta.github.io/imagemean/?valor=570524
         function queryGet() {
         const urlParams = new URLSearchParams(window.location.search);
         const proutovalor = urlParams.get('valor'); // johnny
         document.getElementById("myInput").innerHTML = proutovalor;
         loadDoc();
         }
         
         const textbox = document.getElementById("myInput");
         textbox.addEventListener("keypress", function onEvent(event) {
           if (event.key === "Enter") {
               document.getElementById("buscar").click();
               document.getElementById("myInput").focus();
               document.getElementById("myInput").select();
           }
         });
         
         //
         function buildTable(data){
         var table = document.getElementById('myTable')
           table.innerHTML = "";
         for (var i = 0; i < data.length; i++){
         	var row = `<tr>
         					<td>${data[i].name}</td>
         					<td>${data[i].itemId}</td>
         					<td>${data[i].ean}</td>
                     <td> R$ ${data[i].sellers[0].commertialOffer.ListPrice}</td>
                     <td> R$ ${data[i].sellers[0].commertialOffer.Price}</td>
         			  </tr>`
         	table.innerHTML += row
         
         
         }
         }
         //
         
         function loadDoc() {
         var xhttp = new XMLHttpRequest();
         xhttp.onreadystatechange = function() {
           if (this.readyState == 4 && this.status == 200) {
             var data = JSON.parse(this.responseText);
             var itemsarr = data[0].items;
             //
         
             buildTable(itemsarr);
             //achar index do item
             var codprod = document.getElementById("myInput").value;
             var indexitem = "";
             if (codprod.length == 6) {
               indexitem =  itemsarr.findIndex(obj => obj.itemId==codprod);
                 } else {
                 indexitem = itemsarr.findIndex(obj => obj.ean==codprod);
               }
             
            
            //limpar
            document.getElementById("myimageLarge").src = "";
             document.getElementById("myimage").src = "";
             document.getElementById("myimage2").src = "";
             document.getElementById("myimage3").src = "";
             document.getElementById("myimage4").src = "";
             document.getElementById("myimage5").src = "";
             document.getElementById("myimage6").src = "";
             document.getElementById("myimage7").src = "";
             document.getElementById("myimage8").src = "";
             document.getElementById("myimage9").src = "";
             document.getElementById("myimage10").src = "";
             document.getElementById("nomepro").innerText = "";
             document.getElementById("nomepro").href = "";
            //preencher
            document.getElementById("nomepro").innerText = data[0].items[indexitem].nameComplete;
             document.getElementById("nomepro").href = data[0].link +"?idsku="+ data[0].items[indexitem].itemId;
             
             //
             document.getElementById("myimageLarge").src = data[0].items[indexitem].images[0].imageUrl;
             document.getElementById("myimage").src = data[0].items[indexitem].images[0].imageUrl;
             document.getElementById("myimage2").src = data[0].items[indexitem].images[1].imageUrl;
             document.getElementById("myimage3").src = data[0].items[indexitem].images[2].imageUrl;
             document.getElementById("myimage4").src = data[0].items[indexitem].images[3].imageUrl;
             document.getElementById("myimage5").src = data[0].items[indexitem].images[4].imageUrl;
             document.getElementById("myimage6").src = data[0].items[indexitem].images[5].imageUrl;
             document.getElementById("myimage7").src = data[0].items[indexitem].images[6].imageUrl;
             document.getElementById("myimage8").src = data[0].items[indexitem].images[7].imageUrl;
             document.getElementById("myimage9").src = data[0].items[indexitem].images[8].imageUrl;
             document.getElementById("myimage10").src = data[0].items[indexitem].images[9].imageUrl;
         
           }
         };
         var input = document.getElementById("myInput").value;          
         xhttp.open("GET", "https://api.allorigins.win/raw?url=https://www.cobasi.com.br/api/catalog_system/pub/products/search?fq=alternateIdValues:" + input, true);
         xhttp.send();
         }
      </script>
   </body>
</html>