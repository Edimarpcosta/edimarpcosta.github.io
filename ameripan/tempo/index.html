<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previsão do Tempo - Cidades SP</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #2d3748;
            font-size: 24px;
        }
        
        h2 {
            font-size: 20px;
            color: #2d3748;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* Estilos para o campo de pesquisa */
        .pesquisa-container {
            max-width: 500px;
            margin: 0 auto 20px auto;
            position: relative;
        }
        
        .campo-pesquisa {
            display: flex;
            width: 100%;
        }
        
        .campo-pesquisa input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 5px 0 0 5px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .campo-pesquisa input:focus {
            border-color: #4299e1;
        }
        
        .campo-pesquisa button {
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        
        .campo-pesquisa button:hover {
            background-color: #3182ce;
        }
        
        .resultados-pesquisa {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0 0 5px 5px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .resultados-pesquisa.visivel {
            display: block;
        }
        
        .resultado-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }
        
        .resultado-item:last-child {
            border-bottom: none;
        }
        
        .resultado-item:hover {
            background-color: #f5f7fa;
        }
        
        .resultado-item .nome-cidade {
            font-weight: bold;
            color: #2d3748;
        }
        
        .resultado-item .info-adicional {
            font-size: 12px;
            color: #718096;
        }
        
        .botoes-cidades {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .botoes-cidades button {
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
            margin: 5px;
        }
        
        .botoes-cidades button:hover, .botoes-cidades button.ativo {
            background-color: #3182ce;
        }
        
        .status {
            text-align: center;
            margin-bottom: 20px;
            font-size: 16px;
            color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .ver-mapa {
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }
        
        .ver-mapa:hover {
            background-color: #3182ce;
        }
        
        .ver-mapa svg {
            width: 16px;
            height: 16px;
        }
        
        /* Modal do mapa */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.ativo {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-conteudo {
            background-color: white;
            width: 90%;
            max-width: 800px;
            height: 70vh;
            max-height: 600px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .modal-cabecalho {
            padding: 15px;
            background-color: #4299e1;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-titulo {
            font-size: 18px;
            font-weight: bold;
        }
        
        .modal-fechar {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }
        
        .modal-corpo {
            flex: 1;
            overflow: hidden;
        }
        
        #mapa-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .grade-tempo {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .cartao-tempo {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 12px;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s;
        }
        
        .cartao-tempo:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .data {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 8px;
            font-size: 14px;
        }
        
        .icone-tempo {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .icone-tempo svg {
            width: 60px;
            height: 60px;
        }
        
        .descricao-tempo {
            text-align: center;
            font-size: 13px;
            margin-bottom: 8px;
            color: #4a5568;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .temperatura {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .temp-max {
            color: #e53e3e;
            font-weight: bold;
            font-size: 16px;
        }
        
        .temp-min {
            color: #3182ce;
            font-weight: bold;
            font-size: 16px;
        }
        
        .detalhes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 12px;
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .detalhes div {
            display: flex;
            align-items: center;
        }
        
        .detalhes svg {
            margin-right: 5px;
            width: 14px;
            height: 14px;
        }
        
        /* Estilos para o mini gráfico */
        .mini-grafico-container {
            padding-top: 10px;
            border-top: 1px solid #e2e8f0;
            margin-top: 5px;
            margin-bottom: 5px; /* Adicionando margem inferior */
        }
        
        .mini-grafico {
            width: 100%;
            height: 30px;
            position: relative;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .mini-grafico:hover {
            opacity: 0.8;
        }
        
        .mini-grafico-svg {
            width: 100%;
            height: 100%;
        }
        
        .mini-grafico-pontos {
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            color: #718096;
            margin-top: 2px;
        }
        
        .mini-grafico-titulo {
            font-size: 9px;
            color: #718096;
            text-align: center;
            margin-bottom: 3px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        /* Modal do gráfico detalhado */
        .modal-grafico-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-grafico-overlay.ativo {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-grafico-conteudo {
            background-color: white;
            width: 90%;
            max-width: 800px;
            height: 70vh;
            max-height: 600px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .modal-grafico-cabecalho {
            padding: 15px;
            background-color: #4299e1;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-grafico-titulo {
            font-size: 18px;
            font-weight: bold;
        }
        
        .modal-grafico-fechar {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }
        
        .modal-grafico-corpo {
            flex: 1;
            padding: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .grafico-container {
            flex: 1;
            min-height: 300px;
            position: relative;
            overflow-x: auto; /* Permitir rolagem horizontal em telas pequenas */
        }
        
        .grafico-svg {
            width: 100%;
            height: 100%;
            background-color: #f8fafc;
            border-radius: 5px;
            min-width: 600px; /* Garante que o gráfico não fique muito comprimido */
        }
        
        .grafico-legenda {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 10px 0;
            font-size: 14px;
            flex-wrap: wrap; /* Permitir quebra de linha em telas pequenas */
        }
        
        .grafico-legenda .legenda-item {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 5px 0;
        }
        
        .legenda-cor {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .hoje {
            border: 2px solid #4299e1;
            background-color: #ebf8ff;
        }
        
        .erro {
            color: #e53e3e;
            text-align: center;
            margin-bottom: 20px;
        }

        rodape {
            margin-top: 20px;
            text-align: center;
            color: #718096;
            font-size: 12px;
            padding: 10px 0;
            display: block;
        }

        .legenda-secao {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .legenda-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        /* Estilos para legenda de ícones na seção de explicação */
        .legenda-secao .legenda-grid .legenda-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .legenda-secao .legenda-grid .legenda-item svg {
            margin-right: 10px;
            width: 24px;
            height: 24px;
        }

        .legenda-item-texto {
            font-size: 14px;
        }

        .termos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .termo-item {
            margin-bottom: 15px;
        }

        .termo-nome {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .termo-descricao {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.4;
        }
        
        /* Estilos responsivos */
        @media (max-width: 768px) {
            .botoes-cidades {
                flex-direction: column;
                align-items: center;
            }
            
            .botoes-cidades button {
                width: 100%;
                max-width: 300px;
            }
            
            .grade-tempo {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 15px; /* Aumentado o espaçamento entre cartões */
            }
            
            h1 {
                font-size: 20px;
            }

            h2 {
                font-size: 18px;
            }
            
            .data {
                font-size: 12px;
            }
            
            .icone-tempo svg {
                width: 50px;
                height: 50px;
            }
            
            .detalhes {
                font-size: 11px;
            }

            .legenda-grid, .termos-grid {
                grid-template-columns: 1fr;
            }
            
            /* Ajustes específicos para o mini gráfico em dispositivos móveis */
            .mini-grafico-pontos {
                font-size: 6px; /* Reduzir ainda mais a fonte em dispositivos móveis */
            }
            
            /* Para telas pequenas, esconde horas alternadas */
            .hora-alternada {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Previsão do Tempo 15 dias - Cidades SP</h1>
        
        <!-- Campo de pesquisa -->
        <div class="pesquisa-container">
            <form class="campo-pesquisa" id="form-pesquisa">
                <input 
                    type="text" 
                    id="input-pesquisa" 
                    placeholder="Digite o nome da cidade..." 
                    autocomplete="off"
                    aria-label="Digite o nome da cidade para buscar previsão do tempo">
                <button type="submit" aria-label="Pesquisar cidade">Pesquisar</button>
            </form>
            <div class="resultados-pesquisa" id="resultados-pesquisa"></div>
        </div>
        
        <div class="botoes-cidades">
            <button data-cidade="Piracicaba">Piracicaba, SP</button>
            <button data-cidade="Rio Claro">Rio Claro, SP</button>
            <button data-cidade="Americana">Americana, SP</button>
            <button data-cidade="Amparo">Amparo, SP</button>
            <button data-cidade="Pinhalzinho">Pinhalzinho, SP</button>
            <button data-cidade="Leme">Leme, SP</button>
            <button data-cidade="Tambau">Tambaú, SP</button>
        </div>
		<div> 
		<a href="https://edimarpcosta.github.io/ameripan/tempo/oportunidades" target="_blank">Veja oportunidades</a>
		</div>
        
        <div id="status" class="status">Carregando previsão...</div>
        <div id="erro" class="erro"></div>
        
        <div id="grade-tempo" class="grade-tempo">
            <!-- Os cartões de previsão serão inseridos aqui -->
        </div>
        
        <!-- Nova seção de legenda e termos técnicos -->
        <div class="legenda-secao">
            <h2>Legenda dos Ícones</h2>
            <div class="legenda-grid">
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#FFB700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5" fill="#FFB700"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <div class="legenda-item-texto">Céu limpo/Predominantemente limpo</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 2.1a7 7 0 0 1 10.3 8.4" stroke="#FFB700" stroke-width="2"></path>
                        <circle cx="10" cy="8" r="2.5" fill="#FFB700" stroke="#FFB700"></circle>
                        <path d="M18 12h1a4 4 0 1 1 0 8h-13a5 5 0 0 1-1-9.9" stroke="#9ca3af" fill="#e5e7eb"></path>
                    </svg>
                    <div class="legenda-item-texto">Parcialmente nublado</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" fill="#9ca3af"></path>
                    </svg>
                    <div class="legenda-item-texto">Nublado</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                         <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" fill="#e5e7eb"></path>
                         <path d="M16 17l-2 2m0 0l-2 2m2-2l-2-2m2 2l2 2" stroke="#9CA3AF"></path>
                    </svg>
                    <div class="legenda-item-texto">Neblina</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1" stroke="#60A5FA"></path>
                     </svg>
                    <div class="legenda-item-texto">Garoa leve</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1" stroke="#60A5FA"></path>
                     </svg>
                    <div class="legenda-item-texto">Chuva leve</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1m4-3v1" stroke="#60A5FA"></path>
                     </svg>
                    <div class="legenda-item-texto">Chuva moderada</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9" fill="#e5e7eb"></path>
                        <path d="M13 14l-2 4h3l-1 3" stroke="#F59E0B" fill="none"></path>
                     </svg>
                    <div class="legenda-item-texto">Tempestade</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 17l1 1m3-2l1 1" stroke="#9CA3AF" fill="#white"></path>
                     </svg>
                    <div class="legenda-item-texto">Neve</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2v2M4.93 4.93l1.41 1.41M2 12h2m1.51 6.99l1.41-1.41M12 22v-2m7.99-1.52l-1.41-1.41M22 12h-2M19.57 4.93l-1.41 1.41M12 14l1.25 1.25M12 14l-1.25 1.25M12 14l-1.25-1.25M12 14l1.25-1.25"></path>
                    </svg>
                    <div class="legenda-item-texto">Probabilidade de Chuva</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path>
                    </svg>
                    <div class="legenda-item-texto">Velocidade do Vento</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76" fill="#9CA3AF"></polygon>
                    </svg>
                    <div class="legenda-item-texto">Direção do Vento</div>
                </div>
                <div class="legenda-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <div class="legenda-item-texto">Dia da Previsão</div>
                </div>
            </div>

            <h2>Termos Meteorológicos</h2>
            <div class="termos-grid">
                <div class="termo-item">
                    <div class="termo-nome">Códigos WMO</div>
                    <div class="termo-descricao">Códigos numéricos padronizados pela Organização Meteorológica Mundial (World Meteorological Organization) para classificar diferentes condições climáticas.</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Probabilidade de Precipitação</div>
                    <div class="termo-descricao">A chance percentual de ocorrer qualquer forma de precipitação (chuva, neve, granizo) no período previsto.</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Direção do Vento</div>
                    <div class="termo-descricao">Indicada por pontos cardeais (N-Norte, NE-Nordeste, L-Leste, SE-Sudeste, S-Sul, SO-Sudoeste, O-Oeste, NO-Noroeste) mostrando de onde o vento está soprando.</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Garoa</div>
                    <div class="termo-descricao">Precipitação de gotas muito pequenas (menos de 0,5 mm) que caem lentamente, típica de nuvens baixas.</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Neblina</div>
                    <div class="termo-descricao">Suspensão de gotículas de água muito pequenas no ar, reduzindo a visibilidade (mas geralmente permitindo visibilidade acima de 1 km).</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Temperatura Máxima/Mínima</div>
                    <div class="termo-descricao">As temperaturas mais alta e mais baixa previstas para o período de 24 horas de cada dia.</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Mini Gráfico de Temperatura</div>
                    <div class="termo-descricao">Exibe as temperaturas em pontos específicos do dia (7h, 10h, 13h, 16h, 19h e 22h) para visualização rápida das variações ao longo do dia. Clique para ver o gráfico detalhado hora a hora.</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Gráfico Detalhado</div>
                    <div class="termo-descricao">Mostra as temperaturas a cada hora entre 7h e 22h, permitindo visualizar a tendência completa de temperatura ao longo do dia. Inclui marcações para nascer e pôr do sol.</div>
                </div>
                <div class="termo-item">
                    <div class="termo-nome">Botão "Ver no mapa"</div>
                    <div class="termo-descricao">Permite visualizar a localização exata da cidade em um mapa interativo, garantindo que a previsão corresponda à cidade que você realmente deseja consultar.</div>
                </div>
            </div>
        </div>

        <rodape>
            Dados fornecidos por Open-Meteo API | © 2025 Previsão do Tempo SP
        </rodape>
    </div>

    <div id="modal-grafico" class="modal-grafico-overlay">
        <div class="modal-grafico-conteudo">
            <div class="modal-grafico-cabecalho">
                <div class="modal-grafico-titulo" id="modal-titulo-grafico">Temperatura por Hora</div>
                <button class="modal-grafico-fechar" id="fechar-modal-grafico">&times;</button>
            </div>
            <div class="modal-grafico-corpo">
                <div class="grafico-container">
                    <svg id="grafico-detalhado" class="grafico-svg"></svg>
                </div>
                <div class="grafico-legenda" id="grafico-legenda">
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background-color: #3182ce;"></div>
                        <span>Temperatura</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background-color: #F59E0B;"></div>
                        <span>Nascer do Sol</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background-color: #6B7280;"></div>
                        <span>Pôr do Sol</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="modal-mapa" class="modal-overlay">
        <div class="modal-conteudo">
            <div class="modal-cabecalho">
                <div class="modal-titulo" id="modal-titulo-cidade">Mapa da Cidade</div>
                <button class="modal-fechar" id="fechar-modal">&times;</button>
            </div>
            <div class="modal-corpo">
                <iframe id="mapa-iframe" src="" allowfullscreen></iframe>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const botoesCidades = document.querySelectorAll('.botoes-cidades button');
            const elementoStatus = document.getElementById('status');
            const elementoErro = document.getElementById('erro');
            const gradeTempo = document.getElementById('grade-tempo');
            const formPesquisa = document.getElementById('form-pesquisa');
            const inputPesquisa = document.getElementById('input-pesquisa');
            const resultadosPesquisa = document.getElementById('resultados-pesquisa');
            
            // API de Geocodificação para converter nome da cidade em coordenadas
            const apiGeocod = 'https://geocoding-api.open-meteo.com/v1/search';
            
            // API de Previsão do Tempo
            const apiTempo = 'https://api.open-meteo.com/v1/forecast';
            
            // Dias da semana em português
            const diasSemana = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            
            // Meses em português
            const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            // Ícones SVG para códigos de tempo
            const iconesToempo = {
                0: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#FFB700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5" fill="#FFB700"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>`,
                1: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#FFB700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5" fill="#FFB700"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>`,
                2: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 2.1a7 7 0 0 1 10.3 8.4" stroke="#FFB700" stroke-width="2"></path>
                        <circle cx="10" cy="8" r="2.5" fill="#FFB700" stroke="#FFB700"></circle>
                        <path d="M18 12h1a4 4 0 1 1 0 8h-13a5 5 0 0 1-1-9.9" stroke="#9ca3af" fill="#e5e7eb"></path>
                    </svg>`,
                3: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" fill="#9ca3af"></path>
                    </svg>`,
                45: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                         <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" fill="#e5e7eb"></path>
                         <path d="M16 17l-2 2m0 0l-2 2m2-2l-2-2m2 2l2 2" stroke="#9CA3AF"></path>
                      </svg>`,
                48: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                         <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" fill="#e5e7eb"></path>
                         <path d="M8 15l1 1m2-1l1 1m2-1l1 1" stroke="#9CA3AF"></path>
                      </svg>`,
                51: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1" stroke="#60A5FA"></path>
                     </svg>`,
                53: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1" stroke="#60A5FA"></path>
                     </svg>`,
                55: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1m4-3v1" stroke="#60A5FA"></path>
                     </svg>`,
                61: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1" stroke="#60A5FA"></path>
                     </svg>`,
                63: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1m4-3v1" stroke="#60A5FA"></path>
                     </svg>`,
                65: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1m4-3v1m-8-3v1m4-2v1" stroke="#60A5FA"></path>
                     </svg>`,
                71: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 17l1 1m3-2l1 1" stroke="#9CA3AF" fill="#white"></path>
                     </svg>`,
                80: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 16.2A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#e5e7eb"></path>
                        <path d="M8 19v1m4-2v1m4-3v1" stroke="#60A5FA"></path>
                     </svg>`,
                95: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9" fill="#e5e7eb"></path>
                        <path d="M13 14l-2 4h3l-1 3" stroke="#F59E0B" fill="none"></path>
                     </svg>`,
                96: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9" fill="#e5e7eb"></path>
                        <path d="M13 14l-2 4h3l-1 3" stroke="#F59E0B" fill="none"></path>
                        <circle cx="9" cy="19" r="1" fill="#9CA3AF"></circle>
                     </svg>`,
                99: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9" fill="#e5e7eb"></path>
                        <path d="M13 14l-2 4h3l-1 3" stroke="#F59E0B" fill="none"></path>
                        <circle cx="9" cy="19" r="1" fill="#9CA3AF"></circle>
                        <circle cx="16" cy="19" r="1" fill="#9CA3AF"></circle>
                     </svg>`
            };
            
            // Códigos WMO para fenômenos meteorológicos mais detalhados
            const codigosWMO = {
                0: 'Céu limpo',
                1: 'Predominantemente limpo',
                2: 'Parcialmente nublado',
                3: 'Nublado',
                45: 'Neblina',
                48: 'Depósito de neblina com geada',
                51: 'Garoa leve',
                53: 'Garoa moderada',
                55: 'Garoa intensa',
                56: 'Garoa congelante leve',
                57: 'Garoa congelante densa',
                61: 'Chuva leve',
                63: 'Chuva moderada',
                65: 'Chuva forte',
                66: 'Chuva leve congelante',
                67: 'Chuva forte congelante',
                71: 'Queda de neve leve',
                73: 'Queda de neve moderada', 
                75: 'Queda de neve intensa',
                77: 'Grãos de neve',
                80: 'Chuvas leves',
                81: 'Chuvas moderadas',
                82: 'Chuvas violentas',
                85: 'Flocos de neve leves',
                86: 'Flocos de neve pesados',
                95: 'Tempestade leve ou moderada',
                96: 'Tempestade com granizo leve',
                99: 'Tempestade com granizo forte'
            };
            
            // Ícones de detalhes
            const iconesDetalhes = {
                chuva: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#60A5FA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2v2M4.93 4.93l1.41 1.41M2 12h2m1.51 6.99l1.41-1.41M12 22v-2m7.99-1.52l-1.41-1.41M22 12h-2M19.57 4.93l-1.41 1.41M12 14l1.25 1.25M12 14l-1.25 1.25M12 14l-1.25-1.25M12 14l1.25-1.25"></path>
                      </svg>`,
                vento: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path>
                      </svg>`,
                bussola: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76" fill="#9CA3AF"></polygon>
                          </svg>`,
                calendario: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                          </svg>`
            };
            
            // Formata a data
            function formatarData(data) {
                const dia = data.getDate();
                const mes = meses[data.getMonth()];
                const diaSemana = diasSemana[data.getDay()];
                return `${diaSemana}, ${dia} de ${mes}`;
            }
            
            // Busca as coordenadas da cidade
            async function obterCoordenadas(nomeCidade) {
                try {
                    elementoStatus.textContent = 'Buscando localização...';
                    elementoErro.textContent = '';
                    
                    const resposta = await fetch(`${apiGeocod}?name=${encodeURIComponent(nomeCidade)}&count=1`);
                    const dados = await resposta.json();
                    
                    if (!dados.results || dados.results.length === 0) {
                        throw new Error('Localização não encontrada. Verifique o nome da cidade.');
                    }
                    
                    return {
                        latitude: dados.results[0].latitude,
                        longitude: dados.results[0].longitude,
                        nome: dados.results[0].name,
                        pais: dados.results[0].country
                    };
                } catch (erro) {
                    elementoErro.textContent = erro.message || 'Erro ao buscar coordenadas. Tente novamente.';
                    elementoStatus.textContent = '';
                    return null;
                }
            }
            
            // Busca a previsão do tempo
            async function obterPrevisaoTempo(latitude, longitude) {
                try {
                    elementoStatus.textContent = 'Carregando previsão do tempo...';
                    
                    const resposta = await fetch(`${apiTempo}?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m,weathercode&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_probability_max,windspeed_10m_max,winddirection_10m_dominant&timezone=auto&forecast_days=16`);
                    const dados = await resposta.json();
                    
                    if (!dados.daily) {
                        throw new Error('Dados de previsão não encontrados.');
                    }
                    
                    return dados;
                } catch (erro) {
                    elementoErro.textContent = erro.message || 'Erro ao buscar previsão do tempo. Tente novamente.';
                    elementoStatus.textContent = '';
                    return null;
                }
            }
            
            // Funções para os gráficos
            function criarMiniGrafico(temperaturas, horarios, alturaMaxima = 25) {
                // Filtrar apenas as temperaturas e horários das 7h às 22h, de 3 em 3 horas
                const horasFiltradas = [];
                const tempFiltradas = [];
                
                // Obter as horas para exibir (7, 10, 13, 16, 19, 22)
                const horasDesejadas = [7, 10, 13, 16, 19, 22];
                
                horarios.forEach((horario, index) => {
                    const hora = new Date(horario).getHours();
                    if (horasDesejadas.includes(hora)) {
                        horasFiltradas.push(hora);
                        tempFiltradas.push(temperaturas[index]);
                    }
                });
                
                // Se não houver dados suficientes
                if (tempFiltradas.length < 2) {
                    return '';
                }
                
                // Encontrar temperatura mínima e máxima para escalas
                const tempMin = Math.min(...tempFiltradas);
                const tempMax = Math.max(...tempFiltradas);
                const range = Math.max(tempMax - tempMin, 5); // Garantir pelo menos 5 graus de range
                
                // Calcular pontos do gráfico
                const largura = 100;
                const altura = alturaMaxima;
                const pontos = [];
                const tamanhoSegmento = largura / (horasFiltradas.length - 1);
                
                tempFiltradas.forEach((temp, i) => {
                    // Normalizar temperatura para a altura disponível (invertido para y crescer para baixo)
                    const y = altura - ((temp - tempMin) / range) * altura;
                    const x = i * tamanhoSegmento;
                    pontos.push(`${x},${y}`);
                });
                
                // Criar SVG - Mostrar apenas as principais horas em dispositivos pequenos
                const svg = `
                    <div class="mini-grafico-titulo">Temperatura (°C)</div>
                    <svg class="mini-grafico-svg" viewBox="0 0 ${largura} ${altura}">
                        <polyline 
                            points="${pontos.join(' ')}" 
                            fill="none" 
                            stroke="#3182ce" 
                            stroke-width="1.5" 
                        />
                        ${tempFiltradas.map((temp, i) => {
                            const x = i * tamanhoSegmento;
                            const y = altura - ((temp - tempMin) / range) * altura;
                            return `
                                <circle 
                                    cx="${x}" 
                                    cy="${y}" 
                                    r="2" 
                                    fill="#3182ce" 
                                />
                                <text 
                                    x="${x}" 
                                    y="${y - 5}" 
                                    text-anchor="middle" 
                                    font-size="6" 
                                    fill="#2d3748"
                                >${Math.round(temp)}°</text>
                            `;
                        }).join('')}
                    </svg>
                    <div class="mini-grafico-pontos">
                        ${horasFiltradas.map((hora, index) => {
                            // Aplicar classe especial para horas pares em telas pequenas
                            const classeHora = index % 2 === 1 ? 'hora-alternada' : '';
                            return `<span class="${classeHora}">${hora}h</span>`;
                        }).join('')}
                    </div>
                `;
                
                return svg;
            }
            
            // Função para desenhar o gráfico detalhado
            function criarGraficoDetalhado(dados, dia) {
                // Obter dados do dia específico
                const data = new Date(dados.daily.time[dia]);
                const dataString = data.toISOString().split('T')[0];
                
                // Filtrar temperaturas apenas para o dia selecionado e de 7h às 22h
                const temperaturas = [];
                const horarios = [];
                
                dados.hourly.time.forEach((tempo, index) => {
                    const dataHora = new Date(tempo);
                    const hora = dataHora.getHours();
                    
                    // Verificar se é o mesmo dia e se está no intervalo de 7h às 22h
                    if (dataHora.toISOString().split('T')[0] === dataString && hora >= 7 && hora <= 22) {
                        temperaturas.push(dados.hourly.temperature_2m[index]);
                        horarios.push(tempo);
                    }
                });
                
                // Obter nascer e pôr do sol
                const nascerSol = new Date(dados.daily.sunrise[dia]);
                const porSol = new Date(dados.daily.sunset[dia]);
                
                // Encontrar temperatura mínima e máxima para escalas
                const tempMin = Math.min(...temperaturas);
                const tempMax = Math.max(...temperaturas);
                const range = Math.max(tempMax - tempMin, 5); // Garantir pelo menos 5 graus de range
                const padding = range * 0.1; // 10% de padding
                
                // Configuração do SVG
                const largura = 1000;
                const altura = 400;
                const paddingGrafico = { top: 40, right: 30, bottom: 50, left: 50 };
                const larguraGrafico = largura - paddingGrafico.left - paddingGrafico.right;
                const alturaGrafico = altura - paddingGrafico.top - paddingGrafico.bottom;
                
                // Mapear horas para posições X
                const primeiraHora = new Date(horarios[0]).getHours();
                const horasPorDia = horarios.length;
                const escalaX = larguraGrafico / (horasPorDia - 1);
                
                // Calcular pontos para a linha de temperatura
                const pontos = temperaturas.map((temp, i) => {
                    const x = paddingGrafico.left + i * escalaX;
                    const y = paddingGrafico.top + alturaGrafico - ((temp - (tempMin - padding)) / (range + 2 * padding)) * alturaGrafico;
                    return `${x},${y}`;
                });
                
                // Criar as linhas de grade horizontais
                const linhasGradeY = [];
                const numLinhasY = 5;
                for (let i = 0; i <= numLinhasY; i++) {
                    const y = paddingGrafico.top + alturaGrafico - (i / numLinhasY) * alturaGrafico;
                    linhasGradeY.push(`
                        <line 
                            x1="${paddingGrafico.left}" 
                            y1="${y}" 
                            x2="${largura - paddingGrafico.right}" 
                            y2="${y}" 
                            stroke="#e2e8f0" 
                            stroke-width="1"
                        />
                        <text 
                            x="${paddingGrafico.left - 10}" 
                            y="${y + 5}" 
                            text-anchor="end" 
                            font-size="12" 
                            fill="#718096"
                        >${Math.round(tempMin - padding + (i / numLinhasY) * (range + 2 * padding))}°</text>
                    `);
                }
                
                // Criar marcações de hora e linhas verticais de grade
                const marcasHora = [];
                const linhasGradeX = [];
                horarios.forEach((horario, i) => {
                    const hora = new Date(horario).getHours();
                    const x = paddingGrafico.left + i * escalaX;
                    
                    // Adicionar linha vertical para cada hora (mais clara)
                    linhasGradeX.push(`
                        <line 
                            x1="${x}" 
                            y1="${paddingGrafico.top}" 
                            x2="${x}" 
                            y2="${paddingGrafico.top + alturaGrafico}" 
                            stroke="${hora % 3 === 0 ? '#cbd5e0' : '#edf2f7'}" 
                            stroke-width="${hora % 3 === 0 ? '1' : '0.5'}"
                        />
                    `);
                    
                    // Adicionar marca de hora na parte inferior
                    marcasHora.push(`
                        <line 
                            x1="${x}" 
                            y1="${paddingGrafico.top + alturaGrafico}" 
                            x2="${x}" 
                            y2="${paddingGrafico.top + alturaGrafico + 5}" 
                            stroke="#718096" 
                            stroke-width="1"
                        />
                        <text 
                            x="${x}" 
                            y="${paddingGrafico.top + alturaGrafico + 20}" 
                            text-anchor="middle" 
                            font-size="12" 
                            fill="${hora % 3 === 0 ? '#4a5568' : '#718096'}"
                            font-weight="${hora % 3 === 0 ? 'bold' : 'normal'}"
                        >${hora}:00</text>
                    `);
                });
                
                // Adicionar marcação para nascer e pôr do sol
                const horaNascerSol = nascerSol.getHours() + nascerSol.getMinutes() / 60;
                const horaPorSol = porSol.getHours() + porSol.getMinutes() / 60;
                
                // Calcular posição X para nascer e pôr do sol
                const xNascerSol = paddingGrafico.left + (horaNascerSol - primeiraHora) * escalaX;
                const xPorSol = paddingGrafico.left + (horaPorSol - primeiraHora) * escalaX;
                
                // Marcação para nascer do sol
                let marcacaoNascerSol = '';
                if (horaNascerSol >= 7 && horaNascerSol <= 22) {
                    marcacaoNascerSol = `
                        <line 
                            x1="${xNascerSol}" 
                            y1="${paddingGrafico.top}" 
                            x2="${xNascerSol}" 
                            y2="${paddingGrafico.top + alturaGrafico}" 
                            stroke="#F59E0B" 
                            stroke-width="1.5" 
                            stroke-dasharray="4"
                        />
                        <text 
                            x="${xNascerSol}" 
                            y="${paddingGrafico.top - 10}" 
                            text-anchor="middle" 
                            font-size="12" 
                            fill="#F59E0B"
                            font-weight="bold"
                        >Nascer do Sol ${nascerSol.getHours().toString().padStart(2, '0')}:${nascerSol.getMinutes().toString().padStart(2, '0')}</text>
                    `;
                }
                
                // Marcação para pôr do sol
                let marcacaoPorSol = '';
                if (horaPorSol >= 7 && horaPorSol <= 22) {
                    marcacaoPorSol = `
                        <line 
                            x1="${xPorSol}" 
                            y1="${paddingGrafico.top}" 
                            x2="${xPorSol}" 
                            y2="${paddingGrafico.top + alturaGrafico}" 
                            stroke="#6B7280" 
                            stroke-width="1.5" 
                            stroke-dasharray="4"
                        />
                        <text 
                            x="${xPorSol}" 
                            y="${paddingGrafico.top - 10}" 
                            text-anchor="middle" 
                            font-size="12" 
                            fill="#6B7280"
                            font-weight="bold"
                        >Pôr do Sol ${porSol.getHours().toString().padStart(2, '0')}:${porSol.getMinutes().toString().padStart(2, '0')}</text>
                    `;
                }
                
                // Montar o SVG completo
                return `
                    <svg viewBox="0 0 ${largura} ${altura}" class="grafico-svg">
                        <!-- Fundo do gráfico -->
                        <rect 
                            x="${paddingGrafico.left}" 
                            y="${paddingGrafico.top}" 
                            width="${larguraGrafico}" 
                            height="${alturaGrafico}" 
                            fill="#f8fafc" 
                            rx="5" 
                            ry="5"
                        />
                        
                        <!-- Linhas de grade verticais -->
                        ${linhasGradeX.join('')}
                        
                        <!-- Linhas de grade horizontais -->
                        ${linhasGradeY.join('')}
                        
                        <!-- Marcações de hora -->
                        ${marcasHora.join('')}
                        
                        <!-- Nascer e Pôr do Sol -->
                        ${marcacaoNascerSol}
                        ${marcacaoPorSol}
                        
                        <!-- Linha de temperatura -->
                        <path 
                            d="M${pontos.join(' L')}" 
                            fill="none" 
                            stroke="#3182ce" 
                            stroke-width="3" 
                            stroke-linecap="round" 
                            stroke-linejoin="round"
                        />
                        
                        <!-- Pontos de dados -->
                        ${temperaturas.map((temp, i) => {
                            const x = paddingGrafico.left + i * escalaX;
                            const y = paddingGrafico.top + alturaGrafico - ((temp - (tempMin - padding)) / (range + 2 * padding)) * alturaGrafico;
                            return `
                                <circle 
                                    cx="${x}" 
                                    cy="${y}" 
                                    r="4" 
                                    fill="#3182ce" 
                                    stroke="white" 
                                    stroke-width="1"
                                />
                                <text 
                                    x="${x}" 
                                    y="${y - 10}" 
                                    text-anchor="middle" 
                                    font-size="12" 
                                    fill="#2d3748"
                                    font-weight="bold"
                                >${Math.round(temp)}°</text>
                            `;
                        }).join('')}
                        
                        <!-- Título e Labels de eixos -->
                        <text 
                            x="${largura / 2}" 
                            y="${altura - 10}" 
                            text-anchor="middle" 
                            font-size="14" 
                            fill="#2d3748"
                            font-weight="bold"
                        >Hora do Dia</text>
                        
                        <text 
                            x="${paddingGrafico.left - 35}" 
                            y="${paddingGrafico.top + alturaGrafico / 2}" 
                            text-anchor="middle" 
                            font-size="14" 
                            fill="#2d3748"
                            font-weight="bold"
                            transform="rotate(-90, ${paddingGrafico.left - 35}, ${paddingGrafico.top + alturaGrafico / 2})"
                        >Temperatura (°C)</text>
                    </svg>
                `;
            }
            
            // Função para abrir o modal do gráfico
            function abrirGraficoDetalhado(dados, dia) {
                const data = new Date(dados.daily.time[dia]);
                const modal = document.getElementById('modal-grafico');
                const tituloModal = document.getElementById('modal-titulo-grafico');
                const graficoSVG = document.getElementById('grafico-detalhado');
                
                // Atualizar título
                tituloModal.textContent = `Temperatura para ${formatarData(data)} - ${dados.daily.temperature_2m_min[dia].toFixed(1)}°C a ${dados.daily.temperature_2m_max[dia].toFixed(1)}°C`;
                
                // Criar e inserir o gráfico detalhado
                graficoSVG.innerHTML = criarGraficoDetalhado(dados, dia);
                
                // Garantir que a legenda esteja visível
                const legenda = document.querySelector('.grafico-legenda');
                if (legenda) {
                    legenda.style.display = 'flex';
                }
                
                // Mostrar o modal
                modal.classList.add('ativo');
            }
            
            // Renderiza os cartões de previsão
            function renderizarPrevisao(previsao, nomeCidade) {
                gradeTempo.innerHTML = '';
                
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                // Limita a 15 dias
                const diasPrevisao = Math.min(previsao.daily.time.length, 15);
                
                for (let i = 0; i < diasPrevisao; i++) {
                    const data = new Date(previsao.daily.time[i]);
                    const ehHoje = data.getTime() === hoje.getTime();
                    
                    const codigoTempo = previsao.daily.weathercode[i];
                    
                    // Obter o ícone certo para o código de clima, ou usar um padrão
                    let icone = iconesToempo[codigoTempo];
                    if (!icone) {
                        // Selecionar o ícone mais apropriado com base no código
                        if (codigoTempo >= 51 && codigoTempo <= 57) {
                            // Códigos de garoa
                            icone = iconesToempo[51];
                        } else if (codigoTempo >= 61 && codigoTempo <= 67) {
                            // Códigos de chuva
                            icone = iconesToempo[61];
                        } else if (codigoTempo >= 71 && codigoTempo <= 77) {
                            // Códigos de neve
                            icone = iconesToempo[71];
                        } else if (codigoTempo >= 80 && codigoTempo <= 82) {
                            // Códigos de chuvas
                            icone = iconesToempo[80];
                        } else if (codigoTempo >= 95) {
                            // Códigos de tempestade
                            icone = iconesToempo[95];
                        } else {
                            // Nublado como padrão para qualquer outro código
                            icone = iconesToempo[3];
                        }
                    }
                    
                    // Usar a tabela completa de códigos
                    const descricao = codigosWMO[codigoTempo] || `Código ${codigoTempo}`;
                    const tempMax = Math.round(previsao.daily.temperature_2m_max[i]);
                    const tempMin = Math.round(previsao.daily.temperature_2m_min[i]);
                    const probChuva = previsao.daily.precipitation_probability_max[i];
                    const velVento = Math.round(previsao.daily.windspeed_10m_max[i]);
                    const dirVento = previsao.daily.winddirection_10m_dominant[i];
                    
                    // Formatar nascer e pôr do sol
                    const nascerSol = new Date(previsao.daily.sunrise[i]);
                    const porSol = new Date(previsao.daily.sunset[i]);
                    const formatarHora = (data) => data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    // Criar mini gráfico de temperatura
                    const dataString = data.toISOString().split('T')[0]; // Data no formato YYYY-MM-DD
                    
                    // Filtrar as horas e temperaturas para o dia atual
                    const tempsDia = [];
                    const horasDia = [];
                    
                    previsao.hourly.time.forEach((tempo, idx) => {
                        if (tempo.startsWith(dataString)) {
                            tempsDia.push(previsao.hourly.temperature_2m[idx]);
                            horasDia.push(tempo);
                        }
                    });
                    
                    // Criar o mini gráfico
                    const miniGrafico = criarMiniGrafico(tempsDia, horasDia);
                    
                    const cartao = document.createElement('div');
                    cartao.className = `cartao-tempo ${ehHoje ? 'hoje' : ''}`;
                    cartao.setAttribute('aria-label', `Previsão para ${formatarData(data)}: ${descricao}, temperatura máxima ${tempMax}°C, temperatura mínima ${tempMin}°C`);
                    cartao.setAttribute('data-dia', i);
                    
                    cartao.innerHTML = `
                        <div class="data">${formatarData(data)}</div>
                        <div class="icone-tempo" aria-hidden="true">${icone}</div>
                        <div class="descricao-tempo">${descricao}</div>
                        <div class="temperatura">
                            <div class="temp-max">${tempMax}°C</div>
                            <div class="temp-min">${tempMin}°C</div>
                        </div>
                        <div class="detalhes">
                            <div title="Probabilidade de chuva">${iconesDetalhes.chuva} ${probChuva}%</div>
                            <div title="Velocidade do vento">${iconesDetalhes.vento} ${velVento} km/h</div>
                            <div title="Direção do vento">${iconesDetalhes.bussola} ${obterDirecaoVento(dirVento)}</div>
                            <div title="Dia da previsão">${iconesDetalhes.calendario} ${ehHoje ? 'Hoje' : `Dia ${i + 1}`}</div>
                        </div>
                        <div class="mini-grafico-container">
                            <div class="mini-grafico" title="Clique para ver gráfico detalhado">
                                ${miniGrafico}
                            </div>
                        </div>
                    `;
                    
                    // Adicionar evento para abrir o gráfico detalhado ao clicar no mini gráfico
                    cartao.querySelector('.mini-grafico').addEventListener('click', () => {
                        abrirGraficoDetalhado(previsao, i);
                    });
                    
                    gradeTempo.appendChild(cartao);
                }
                
                elementoStatus.textContent = `Previsão para ${nomeCidade}`;
            }
            
            // Converte a direção do vento de graus para pontos cardeais
            function obterDirecaoVento(graus) {
                const direcoes = ['N', 'NE', 'L', 'SE', 'S', 'SO', 'O', 'NO'];
                return direcoes[Math.round(graus / 45) % 8];
            }
            
            // Função para pesquisar cidades
            async function pesquisarCidades(termo) {
                if (!termo || termo.trim().length < 2) {
                    resultadosPesquisa.innerHTML = '';
                    resultadosPesquisa.classList.remove('visivel');
                    return;
                }
                
                try {
                    elementoStatus.textContent = 'Buscando cidades...';
                    
                    const resposta = await fetch(`${apiGeocod}?name=${encodeURIComponent(termo)}&count=5`);
                    const dados = await resposta.json();
                    
                    resultadosPesquisa.innerHTML = '';
                    
                    if (!dados.results || dados.results.length === 0) {
                        resultadosPesquisa.innerHTML = `<div class="resultado-item">Nenhuma cidade encontrada para "${termo}"</div>`;
                        resultadosPesquisa.classList.add('visivel');
                        elementoStatus.textContent = '';
                        return;
                    }
                    
                    // Mostrar resultados
                    dados.results.forEach(cidade => {
                        const itemResultado = document.createElement('div');
                        itemResultado.className = 'resultado-item';
                        
                        let regiaoInfo = '';
                        if (cidade.admin1) {
                            regiaoInfo += cidade.admin1;
                        }
                        
                        itemResultado.innerHTML = `
                            <div class="nome-cidade">${cidade.name}</div>
                            <div class="info-adicional">${regiaoInfo}, ${cidade.country}</div>
                        `;
                        
                        itemResultado.addEventListener('click', () => {
                            buscarTempo(cidade.name, {
                                latitude: cidade.latitude,
                                longitude: cidade.longitude,
                                nome: cidade.name,
                                pais: cidade.country
                            });
                            
                            inputPesquisa.value = `${cidade.name}, ${cidade.country}`;
                            resultadosPesquisa.classList.remove('visivel');
                            inputPesquisa.blur();
                        });
                        
                        resultadosPesquisa.appendChild(itemResultado);
                    });
                    
                    resultadosPesquisa.classList.add('visivel');
                    elementoStatus.textContent = '';
                    
                } catch (erro) {
                    console.error('Erro ao pesquisar cidades:', erro);
                    elementoErro.textContent = 'Erro ao buscar cidades. Tente novamente.';
                    elementoStatus.textContent = '';
                }
            }
            
            // Manipular pesquisa
            formPesquisa.addEventListener('submit', async function(e) {
                e.preventDefault();
                const termo = inputPesquisa.value.trim();
                
                if (termo.length >= 2) {
                    // Pesquisa direta - se apenas um resultado, busca imediatamente
                    try {
                        const resposta = await fetch(`${apiGeocod}?name=${encodeURIComponent(termo)}&count=1`);
                        const dados = await resposta.json();
                        
                        if (dados.results && dados.results.length > 0) {
                            const cidade = dados.results[0];
                            buscarTempo(cidade.name, {
                                latitude: cidade.latitude,
                                longitude: cidade.longitude,
                                nome: cidade.name,
                                pais: cidade.country
                            });
                            
                            inputPesquisa.value = `${cidade.name}, ${cidade.country}`;
                            resultadosPesquisa.classList.remove('visivel');
                        } else {
                            // Se não encontrou resultado direto, mostra opções
                            pesquisarCidades(termo);
                        }
                    } catch (erro) {
                        console.error('Erro ao pesquisar cidade:', erro);
                        pesquisarCidades(termo); // Mostra opções em caso de erro
                    }
                }
            });
            
            // Pesquisa ao digitar
            let timerId;
            inputPesquisa.addEventListener('input', function() {
                clearTimeout(timerId);
                timerId = setTimeout(() => {
                    const termo = inputPesquisa.value.trim();
                    pesquisarCidades(termo);
                }, 300); // Delay para evitar muitas requisições
            });
            
            // Fechar resultados ao clicar fora
            document.addEventListener('click', function(e) {
                if (!inputPesquisa.contains(e.target) && !resultadosPesquisa.contains(e.target)) {
                    resultadosPesquisa.classList.remove('visivel');
                }
            });
            
            // Focus no input mostra resultados anteriores
            inputPesquisa.addEventListener('focus', function() {
                if (resultadosPesquisa.children.length > 0) {
                    resultadosPesquisa.classList.add('visivel');
                }
            });
            
            // Função para abrir o mapa
            function abrirMapa() {
                if (!window.ultimaCidade) return;
                
                const modal = document.getElementById('modal-mapa');
                const iframe = document.getElementById('mapa-iframe');
                const titulo = document.getElementById('modal-titulo-cidade');
                
                // Atualizar o título do modal
                titulo.textContent = `Mapa de ${window.ultimaCidade.nome}, ${window.ultimaCidade.pais}`;
                
                // Atualizar o src do iframe para mostrar a localização no OpenStreetMap
                iframe.src = `https://www.openstreetmap.org/export/embed.html?bbox=${window.ultimaCidade.longitude-0.1}%2C${window.ultimaCidade.latitude-0.1}%2C${window.ultimaCidade.longitude+0.1}%2C${window.ultimaCidade.latitude+0.1}&layer=mapnik&marker=${window.ultimaCidade.latitude}%2C${window.ultimaCidade.longitude}`;
                
                // Mostrar o modal
                modal.classList.add('ativo');
            }
            
            // Busca a previsão para a cidade selecionada
            async function buscarTempo(nomeCidade, coordenadasDiretas = null) {
                let coordenadas = coordenadasDiretas;
                
                if (!coordenadas) {
                    coordenadas = await obterCoordenadas(nomeCidade);
                }
                
                if (coordenadas) {
                    const previsao = await obterPrevisaoTempo(coordenadas.latitude, coordenadas.longitude);
                    
                    if (previsao) {
                        // Armazenar as coordenadas globalmente para uso no mapa
                        window.ultimaCidade = {
                            nome: coordenadas.nome,
                            pais: coordenadas.pais,
                            latitude: coordenadas.latitude,
                            longitude: coordenadas.longitude
                        };
                        
                        renderizarPrevisao(previsao, `${coordenadas.nome}, ${coordenadas.pais}`);
                        
                        // Adicionar botão "Ver no mapa"
                        const statusElement = document.getElementById('status');
                        const mapButton = document.createElement('button');
                        mapButton.className = 'ver-mapa';
                        mapButton.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Ver no mapa
                        `;
                        mapButton.addEventListener('click', abrirMapa);
                        
                        // Verificar se já existe um botão e removê-lo
                        const botaoExistente = statusElement.querySelector('.ver-mapa');
                        if (botaoExistente) {
                            botaoExistente.remove();
                        }
                        
                        // Adicionar o botão ao status
                        statusElement.appendChild(mapButton);
                    }
                }
                
                // Destaca o botão da cidade selecionada (apenas se for uma das cidades predefinidas)
                botoesCidades.forEach(botao => {
                    botao.classList.remove('ativo');
                    if (botao.dataset.cidade === nomeCidade) {
                        botao.classList.add('ativo');
                    }
                });
            }
            
            // Eventos para os botões das cidades
            botoesCidades.forEach(botao => {
                botao.addEventListener('click', () => {
                    const nomeCidade = botao.dataset.cidade;
                    buscarTempo(nomeCidade);
                });
                
                // Adicionar acessibilidade
                botao.setAttribute('aria-label', `Ver previsão para ${botao.dataset.cidade}`);
            });
            
            // Configurar fechamento do modal
            document.getElementById('fechar-modal').addEventListener('click', () => {
                document.getElementById('modal-mapa').classList.remove('ativo');
            });
            
            // Fechar o modal clicando fora dele
            document.getElementById('modal-mapa').addEventListener('click', (e) => {
                if (e.target === document.getElementById('modal-mapa')) {
                    document.getElementById('modal-mapa').classList.remove('ativo');
                }
            });
            
            // Configurar fechamento do modal de gráfico
            document.getElementById('fechar-modal-grafico').addEventListener('click', () => {
                document.getElementById('modal-grafico').classList.remove('ativo');
            });
            
            // Fechar o modal de gráfico clicando fora dele
            document.getElementById('modal-grafico').addEventListener('click', (e) => {
                if (e.target === document.getElementById('modal-grafico')) {
                    document.getElementById('modal-grafico').classList.remove('ativo');
                }
            });

            
  	//-- Funções novas para ler https://edimarpcosta.github.io/ameripan/tempo/?city=Charqueada
 

    // Função para pegar o parâmetro da URL
    function getCidadeDaURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('city');
    }

    const cidadeURL = getCidadeDaURL();

    // Se tiver cidade na URL, usa ela. Senão, usa Piracicaba
    if (cidadeURL && cidadeURL.trim() !== '') {
        inputPesquisa.value = cidadeURL;
        formPesquisa.dispatchEvent(new Event('submit'));
    } else {
        buscarTempo('Piracicaba');
    }
});
    </script>
</body>
</html>
