<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <title>Formulário de Cotação de Preços - Ameripan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* --- Reset Básico e Estilo Global --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            font-size: 14px;
        }
        .container {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            max-width: 1000px;
            margin: auto;
        }
        h1, h2 {
            color: #005A9C; /* Azul Ameripan */
            text-align: center;
            margin-bottom: 25px;
        }
        h2 {
            text-align: left;
            font-size: 1.3em;
            margin-top: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f2f5;
        }

        /* --- Seções e Grids Responsivos --- */
        .form-section { margin-bottom: 25px; }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px 20px;
        }
        .form-grid-full { grid-column: 1 / -1; }

        /* --- Estilos de Campos de Formulário --- */
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
        }
        input[type="text"],
        input[type="date"],
        input[type="number"],
        input[type="tel"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="number"]:focus,
        input[type.="tel"]:focus {
            border-color: #005A9C;
            box-shadow: 0 0 0 3px rgba(0, 90, 156, 0.1);
            outline: none;
        }
        .error-input { border-color: #dc3545 !important; }

        /* --- Cabeçalho com Botão de Ação --- */
        .header-with-action {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; 
        }
        .btn-clear-memory {
            background-color: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-clear-memory:hover {
            background-color: #e2e6ea;
            color: #343a40;
            border-color: #adb5bd;
        }
        .btn-clear-memory .fa-eraser { margin-right: 5px; }
        
        /* --- Tabela de Produtos Responsiva --- */
        .table-products-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 15px;
            position: relative;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .table-loading-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.85);
            display: flex; align-items: center; justify-content: center;
            z-index: 10; font-style: italic; color: #555;
            font-size: 1.1em; border-radius: 5px;
        }
        .table-products {
            width: 100%;
            min-width: 900px; /* Força scroll horizontal */
            border-collapse: collapse;
            word-wrap: break-word;
        }
        .table-products th,
        .table-products td {
            border: 1px solid #e0e0e0;
            padding: 8px;
            text-align: left;
            font-size: 13px;
            vertical-align: top;
        }
        .table-products th {
            background-color: #f8f9fa;
            color: #333;
            font-weight: 600;
            white-space: nowrap;
        }
        .table-products td { background-color: #fff; }
        .table-products td input { padding: 6px; font-size: 13px; }
        
        /* CORREÇÃO: Ícone de Dica com cursor 'pointer' */
        .hint-icon {
            color: #007bff;
            cursor: pointer; /* MUDADO de 'help' para 'pointer' */
            font-size: 0.9em;
            margin-left: 4px;
        }
        
        .col-cod { width: 10%; }
        .col-nome { width: 28%; }
        .col-flex, .col-custo, .col-concorrente { width: 10%; }
        .col-foto { width: 22%; }
        .col-acao { width: 10%; text-align: center; }

        /* --- Botões --- */
        .btn {
            padding: 10px 18px; border: none; border-radius: 5px;
            cursor: pointer; font-size: 15px; font-weight: 600;
            transition: all 0.2s ease; text-align: center;
        }
        .btn-add {
            background-color: #28a745; color: white;
            margin-top: 15px;
        }
        .btn-add:hover { background-color: #218838; }
        .btn-remove {
            background-color: #dc3545; color: white;
            padding: 6px 10px; font-size: 12px; width: 100%;
        }
        .btn-remove:hover { background-color: #c82333; }
        .btn-submit {
            background-color: #005A9C; color: white;
            padding: 12px 20px; font-size: 16px;
            width: 100%; margin-top: 25px;
        }
        .btn-submit:hover { background-color: #004a80; }
        .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; }

        /* --- Mensagens de Status --- */
        .status-message {
            text-align: center; padding: 10px; margin-top: 15px;
            border-radius: 5px; font-size: 1em; display: none;
        }
        .status-loading { background-color: #e9ecef; color: #495057; }
        .status-error { background-color: #f8d7da; color: #721c24; }
        .status-success { background-color: #d4edda; color: #155724; }

        /* --- Lógica de Busca (Dropdown) --- */
        .search-results-container {
            position: absolute; z-index: 1000;
            background-color: #fff; border: 1px solid #ccc;
            border-radius: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-height: 250px; overflow-y: auto;
        }
        .search-results-container div {
            padding: 10px; cursor: pointer; font-size: 13px;
        }
        .search-results-container div:hover { background-color: #f0f2f5; }
        .search-results-container div strong { color: #005A9C; }
    </style>
</head>
<body>

    <div class="container">
        <form id="form-cotacao" onsubmit="handleFormSubmit(event)">
            <h1>Formulário de Cotação de Preços</h1>

            <div class="form-section">
                <div class="header-with-action">
                    <h2>Identificação</h2>
                    <button type="button" class="btn-clear-memory" id="btnClearMemory" title="Limpar dados salvos (Supervisor, Vendedor, Cidade)">
                        <i class="fas fa-eraser"></i> Limpar Memória
                    </button>
                </div>
                
                <div class="form-grid">
                    <div>
                        <label for="dataCotacao">Data:</label>
                        <input type="date" id="dataCotacao" required>
                    </div>
                    <div>
                        <label for="supervisorNome">Supervisor:</label>
                        <input type="text" id="supervisorNome" placeholder="Nome do Supervisor" required>
                    </div>
                    <div>
                        <label for="vendedorNome">Vendedor:</label>
                        <input type="text" id="vendedorNome" placeholder="Nome do Vendedor" required>
                    </div>
                    <div>
                        <label for="cidade">Cidade:</label>
                        <input type="text" id="cidade" placeholder="Cidade da cotação" required>
                    </div>
                    <div class="form-grid-full">
                        <label for="cliente">Cliente (Cód ou Nome) (Opcional):</label>
                        <input type="text" id="cliente" placeholder="Ex: 5040 - Nome do Cliente">
                    </div>
                    <div class="form-grid-full">
                        <label for="concorrenteHeader">Concorrente (Opcional):</label>
                        <input type="text" id="concorrenteHeader" list="concorrentes-lista" placeholder="Nome do concorrente">
                        <datalist id="concorrentes-lista">
                            <option value="Allpan"></option>
                            <option value="Dorivali"></option>
                            <option value="Sorvepan"></option>
                            <option value="Casa Confeifeiro"></option>
                            <option value="Diniz"></option>
                            <option value="Limerpan"></option>
                            <option value="Marquespan"></option>
                        </datalist>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>Produtos Cotados</h2>
                <div class="table-products-container">
                    <div class="table-loading-overlay" id="tableLoadingOverlay">
                        <i class="fas fa-spinner fa-spin"></i> &nbsp; Carregando lista de produtos...
                    </div>
                    <table class="table-products" id="tabelaProdutos">
                        <thead>
                            <tr>
                                <th class="col-cod">Cód. Produto</th>
                                <th class="col-nome">
                                    Nome Produto
                                    <i class="fas fa-info-circle hint-icon" 
                                       onclick="showSearchHint(event)"
                                       title="Clique para ver a dica de busca"></i>
                                </th>
                                <th class="col-flex">Preço Flex</th>
                                <th class="col-custo">Custo (Opc.)</th>
                                <th class="col-concorrente">Preço Concorrente</th>
                                <th class="col-foto">Link Foto NF (Opc.)</th>
                                <th class="col-acao">Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                <div class="search-results-container" id="searchResults" style="display: none;"></div>
                
                <div id="product-load-status" class="status-message"></div>
                <button type="button" class="btn btn-add" id="btnAdicionarProduto">
                    <i class="fas fa-plus"></i> Adicionar Produto
                </button>
            </div>

            <button type="submit" class="btn btn-submit" id="btn-submit">
                <i class="fas fa-save"></i> Salvar Cotações
            </button>
            
            <div id="form-status" class="status-message"></div>
        </form>
    </div>

    <script>
        // =======================================================================
        // PARTE 1: CONFIGURAÇÕES E INICIALIZAÇÃO
        // =======================================================================

        // --- Configurações Google Sheets (LEITURA DE PRODUTOS) ---
        const SPREADSHEET_ID = '1cN_1GBR29BN77eRZAkzvikt96i_kX9AZ04cTc6XRM8Q';
        const API_KEY = 'AIzaSyChiZPUY-G3oyZN2NGY_vlgRXUzry9Pkeo';
        const PRODUCTS_SHEET_NAME = 'produtos';
        const PRODUCTS_RANGE = 'A2:B';

        // --- Configurações Google Apps Script (GRAVAÇÃO DE COTAÇÃO) ---
        const URL_DO_APPS_SCRIPT = "https://script.google.com/macros/s/AKfycbw3aHahFM5jItTRIaZKhmJl0E_XDKSKmMtFLjgpY61e6yOGNOYuj1qBXTG4I-TL5OAYWA/exec"; // Lembre-se de colar sua URL

        // --- Configurações de Memória Local ---
        const SUPERVISOR_STORAGE_KEY = 'cotacaoSupervisor_Session';
        const VENDEDOR_STORAGE_KEY = 'cotacaoVendedor_Session';
        const CIDADE_STORAGE_KEY = 'cotacaoCidade_Session';
        
        // --- Variáveis Globais ---
        let productList = [];
        let activeSearchInput = null;
        let productLoadError = false;

        // --- Inicialização da Página ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('dataCotacao').value = getTodayDateString();
            loadSavedData();
            
            loadProductsFromSheet().then(() => {
                if (!productLoadError) {
                    adicionarProdutoLinha();
                }
            });

            // --- Event Listeners Globais ---
            document.getElementById('supervisorNome').addEventListener('blur', saveDataToMemory);
            document.getElementById('vendedorNome').addEventListener('blur', saveDataToMemory);
            document.getElementById('cidade').addEventListener('blur', saveDataToMemory);
            document.getElementById('btnClearMemory').addEventListener('click', clearSavedData);
            document.getElementById('btnAdicionarProduto').addEventListener('click', adicionarProdutoLinha);
            
            document.addEventListener('click', (e) => {
                if (!e.target.classList.contains('input-nome') && !e.target.closest('#searchResults')) {
                    document.getElementById('searchResults').style.display = 'none';
                }
            });
        });

        // =======================================================================
        // PARTE 2: CARREGAMENTO E BUSCA DE PRODUTOS (PLANILHA 1)
        // =======================================================================

        async function loadProductsFromSheet() {
            const loadingOverlay = document.getElementById('tableLoadingOverlay');
            const productStatus = document.getElementById('product-load-status');
            
            loadingOverlay.style.display = 'flex';
            productStatus.textContent = 'Carregando lista de produtos...';
            productStatus.className = 'status-message status-loading';
            productStatus.style.display = 'block';
            
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${PRODUCTS_SHEET_NAME}!${PRODUCTS_RANGE}?key=${API_KEY}&_=${new Date().getTime()}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Erro HTTP ${response.status}: ${response.statusText}`);
                
                const data = await response.json();
                productList = [];
                
                if (data.values && data.values.length > 0) {
                    data.values.forEach(row => {
                        if (row[0] && row[1]) {
                            productList.push({ 
                                sku: String(row[0]).trim(), 
                                name: String(row[1]).trim() 
                            });
                        }
                    });
                    productStatus.textContent = `${productList.length} produtos carregados!`;
                    productStatus.className = 'status-message status-success';
                    setTimeout(() => { productStatus.style.display = 'none'; }, 3000);
                } else {
                    throw new Error("Nenhum produto encontrado na planilha.");
                }
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                productStatus.textContent = `Erro ao carregar produtos: ${error.message}`;
                productStatus.className = 'status-message status-error';
                productLoadError = true;
            } finally {
                loadingOverlay.style.display = 'none';
            }
        }

        function handleNameInput(event) {
            const input = event.target;
            const query = input.value.trim().toUpperCase();
            activeSearchInput = input;

            if (query.length < 2) {
                document.getElementById('searchResults').style.display = 'none';
                return;
            }

            const results = searchProducts(query);
            displaySearchResults(results, input);
        }

        function searchProducts(query) {
            const terms = query.split('*').filter(t => t); 
            const results = productList.filter(product => {
                const productName = product.name.toUpperCase();
                return terms.every(term => productName.includes(term));
            });
            return results.slice(0, 10);
        }

        function displaySearchResults(results, inputElement) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';

            if (results.length === 0) {
                resultsContainer.style.display = 'none';
                return;
            }

            results.forEach(product => {
                const item = document.createElement('div');
                item.innerHTML = `<strong>${product.sku}</strong> - ${product.name}`;
                item.onclick = () => selectProduct(product);
                resultsContainer.appendChild(item);
            });

            const rect = inputElement.getBoundingClientRect();
            resultsContainer.style.left = `${rect.left + window.scrollX}px`;
            resultsContainer.style.top = `${rect.bottom + window.scrollY}px`;
            resultsContainer.style.width = `${rect.width}px`;
            resultsContainer.style.display = 'block';
        }

        function selectProduct(product) {
            if (!activeSearchInput) return;
            
            const row = activeSearchInput.closest('tr');
            row.querySelector('.input-cod').value = product.sku;
            row.querySelector('.input-nome').value = product.name;

            document.getElementById('searchResults').style.display = 'none';
            activeSearchInput = null;
        }

        function handleSkuBlur(event) {
            const codInput = event.target;
            const codigo = codInput.value.trim();
            const row = codInput.closest('tr');
            const nomeInput = row.querySelector('.input-nome');

            if (codigo) {
                const product = productList.find(p => p.sku === codigo);
                if (product) {
                    nomeInput.value = product.name;
                }
            }
        }

        // =======================================================================
        // PARTE 3: LÓGICA DO FORMULÁRIO (Adicionar/Remover/Enviar)
        // =======================================================================

        function adicionarProdutoLinha() {
            const tabelaCorpo = document.getElementById('tabelaProdutos').getElementsByTagName('tbody')[0];
            const novaLinha = tabelaCorpo.insertRow();

            novaLinha.innerHTML = `
                <td class="col-cod"><input type="text" class="input-cod" placeholder="SKU"></td>
                <td class="col-nome"><input type="text" class="input-nome" placeholder="Digite o nome (ex: bis*briga*)"></td>
                <td class="col-flex"><input type="text" class="input-preco" placeholder="R$"></td>
                <td class="col-custo"><input type="text" class="input-preco" placeholder="R$ (Opc.)"></td>
                <td class="col-concorrente"><input type="text" class="input-preco" placeholder="R$"></td>
                <td class="col-foto"><input type="text" class="input-foto" placeholder="Cole o link da foto/NF"></td>
                <td class="col-acao"><button type="button" class="btn btn-remove" onclick="removerProdutoLinha(this)">Remover</button></td>
            `;

            novaLinha.querySelector('.input-cod').addEventListener('blur', handleSkuBlur);
            novaLinha.querySelector('.input-nome').addEventListener('input', handleNameInput);
            novaLinha.querySelector('.input-nome').addEventListener('focus', handleNameInput);
            
            novaLinha.querySelectorAll('.input-preco').forEach(input => {
                input.addEventListener('blur', (e) => formatarInputValorMonetario(e.target));
            });
        }

        function removerProdutoLinha(botao) {
            const linha = botao.closest('tr');
            linha.parentNode.removeChild(linha);
        }
        
        function validarFormulario() {
            let isValid = true;
            document.querySelectorAll('.error-input').forEach(el => el.classList.remove('error-input'));

            const camposCabecalho = ['dataCotacao', 'supervisorNome', 'vendedorNome', 'cidade'];
            camposCabecalho.forEach(id => {
                const input = document.getElementById(id);
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('error-input');
                }
            });

            const linhasProdutos = document.getElementById('tabelaProdutos').getElementsByTagName('tbody')[0].rows;
            if (linhasProdutos.length === 0) {
                isValid = false;
                alert("Você deve adicionar pelo menos um produto.");
                return false;
            }

            let linhasValidas = 0;
            for (const linha of linhasProdutos) {
                const cod = linha.querySelector('.input-cod');
                const nome = linha.querySelector('.input-nome');
                const flex = linha.querySelectorAll('.input-preco')[0];
                const concorrente = linha.querySelectorAll('.input-preco')[2];

                const camposLinha = [cod, nome, flex, concorrente];
                
                if (camposLinha.every(input => !input.value.trim())) continue;

                let linhaValida = true;
                camposLinha.forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                        linhaValida = false;
                        input.classList.add('error-input');
                    }
                });
                
                if(linhaValida) linhasValidas++;
            }
            
            if (linhasValidas === 0) {
                isValid = false;
                alert("Nenhuma linha de produto foi preenchida corretamente. (Campos obrigatórios: Cód., Nome, Preço Flex, Preço Concorrente).");
            }
            
            return isValid;
        }

        async function handleFormSubmit(event) {
            event.preventDefault(); 

            if (!validarFormulario()) {
                alert("Por favor, corrija os campos destacados em vermelho.");
                return;
            }
            
            if (!URL_DO_APPS_SCRIPT.includes("script.google.com/macros")) {
                alert("ERRO: A 'URL_DO_APPS_SCRIPT' no código JS não foi configurada.");
                return;
            }

            const btnSubmit = document.getElementById("btn-submit");
            const formStatus = document.getElementById("form-status");

            btnSubmit.disabled = true;
            btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
            formStatus.style.display = 'none';

            try {
                const header = {
                    data: document.getElementById('dataCotacao').value,
                    supervisor: document.getElementById('supervisorNome').value.trim(),
                    vendedor: document.getElementById('vendedorNome').value.trim(),
                    cidade: document.getElementById('cidade').value.trim(),
                    cliente: document.getElementById('cliente').value.trim(),
                    concorrente: document.getElementById('concorrenteHeader').value.trim()
                };

                const products = [];
                const linhasProdutos = document.getElementById('tabelaProdutos').getElementsByTagName('tbody')[0].rows;
                
                for (const linha of linhasProdutos) {
                    const cod = linha.querySelector('.input-cod').value.trim();
                    const nome = linha.querySelector('.input-nome').value.trim();
                    const precos = linha.querySelectorAll('.input-preco');
                    
                    if (!cod && !nome) continue; 
                    
                    products.push({
                        cod: cod,
                        nome: nome,
                        flex: parseValorUsuario(precos[0].value),
                        custo: parseValorUsuario(precos[1].value),
                        concorrente: parseValorUsuario(precos[2].value),
                        foto: linha.querySelector('.input-foto').value.trim() 
                    });
                }
                
                if (products.length === 0) {
                    throw new Error("Nenhum produto válido para enviar.");
                }

                const payload = JSON.stringify({ header, products });
                
                const response = await fetch(URL_DO_APPS_SCRIPT, {
                    method: "POST",
                    body: payload,
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                });

                const resultado = await response.json();

                if (resultado.status === "sucesso") {
                    formStatus.textContent = `✅ Sucesso! ${resultado.linhasGravadas} linhas de cotação salvas.`;
                    formStatus.className = 'status-message status-success';
                    document.getElementById('form-cotacao').reset();
                    document.getElementById('dataCotacao').value = getTodayDateString();
                    loadSavedData();
                    document.getElementById('tabelaProdutos').getElementsByTagName('tbody')[0].innerHTML = '';
                    adicionarProdutoLinha();
                } else {
                    throw new Error(resultado.erro);
                }

            } catch (error) {
                console.error("Erro no envio:", error);
                formStatus.textContent = `❌ Erro: ${error.message}`;
                formStatus.className = 'status-message status-error';
            } finally {
                formStatus.style.display = 'block';
                btnSubmit.disabled = false;
                btnSubmit.innerHTML = '<i class="fas fa-save"></i> Salvar Cotações';
            }
        }

        // =======================================================================
        // PARTE 4: FUNÇÕES UTILITÁRIAS (Memória, Formatação e Dica)
        // =======================================================================

        /**
         * NOVO: Exibe a dica de busca ao clicar no ícone.
         */
        function showSearchHint(event) {
            // Previne que o clique dispare outros eventos (ex: ordenar tabela)
            event.stopPropagation(); 
            alert(
                "Dica de Pesquisa:\n\n" +
                "Use o caractere '*' (asterisco) como um curinga para pesquisar por partes do nome.\n\n" +
                "Exemplos:\n" +
                "- 'BISC*BRIGA' (encontra: BISC. - BRIGADEIRO)\n" +
                "- 'LEITE*COND' (encontra: LEITE CONDENSADO)"
            );
        }
        
        function getTodayDateString() {
            return new Date().toISOString().split('T')[0];
        }

        function saveDataToMemory() {
            sessionStorage.setItem(SUPERVISOR_STORAGE_KEY, document.getElementById('supervisorNome').value.trim());
            sessionStorage.setItem(VENDEDOR_STORAGE_KEY, document.getElementById('vendedorNome').value.trim());
            sessionStorage.setItem(CIDADE_STORAGE_KEY, document.getElementById('cidade').value.trim());
        }

        function loadSavedData() {
            document.getElementById('supervisorNome').value = sessionStorage.getItem(SUPERVISOR_STORAGE_KEY) || '';
            document.getElementById('vendedorNome').value = sessionStorage.getItem(VENDEDOR_STORAGE_KEY) || '';
            document.getElementById('cidade').value = sessionStorage.getItem(CIDADE_STORAGE_KEY) || '';
        }
        
        function clearSavedData() {
            sessionStorage.removeItem(SUPERVISOR_STORAGE_KEY);
            sessionStorage.removeItem(VENDEDOR_STORAGE_KEY);
            sessionStorage.removeItem(CIDADE_STORAGE_KEY);
            
            document.getElementById('supervisorNome').value = '';
            document.getElementById('vendedorNome').value = '';
            document.getElementById('cidade').value = '';
            
            alert('Dados de Supervisor, Vendedor e Cidade foram limpos da memória.');
        }

        function parseValorUsuario(valorStr) {
            if (!valorStr || typeof valorStr !== 'string') return 0;
            let valorLimpo = valorStr.replace(/\./g, '');
            valorLimpo = valorLimpo.replace(',', '.');
            valorLimpo = valorLimpo.replace(/[^\d.]/g, '');
            const numero = parseFloat(valorLimpo);
            return isNaN(numero) ? 0 : numero;
        }

        function formatarNumeroParaInput(numero) {
            if (typeof numero !== 'number' || isNaN(numero)) return '0,00';
            return numero.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatarInputValorMonetario(inputElement) {
            const valorNumerico = parseValorUsuario(inputElement.value || '0');
            inputElement.value = (valorNumerico === 0) ? '' : formatarNumeroParaInput(valorNumerico);
        }

    </script>
</body>
</html>
