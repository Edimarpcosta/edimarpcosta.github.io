<!DOCTYPE html>
<html>
<head>
    <title>Mapa com Marcadores</title>
    <style>
        /* Definir a altura da div 'map' para ocupar 100% da altura da janela */
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-DrT5T0rhqjO7y4Y47w5cRPyKBrqLYpN09p0yJGvVrF0=" crossorigin="anonymous"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_DqAfjDQHOGESUrUboqiVYv0qGa1WeJc&callback=initMap" async defer></script>
    <script>
        var map;

        function initMap() {
            var geocoder = new google.maps.Geocoder();
            var infowindows = [];

            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -22.480796, lng: -47.451883 },
                zoom: 14
            });

            $.getJSON('https://raw.githubusercontent.com/Edimarpcosta/edimarpcosta.github.io/main/ameripan/cli/cli.json', function (data) {
                data.forEach(function (location) {
                    geocoder.geocode({ 'address': location.address }, function (results, status) {
                        if (status === 'OK') {
                            var marker = new google.maps.Marker({
                                map: map,
                                position: results[0].geometry.location,
                                title: location.name
                            });

                            var infowindow = new google.maps.InfoWindow({
                                content: location.name + "<br>" + location.address
                            });

                            marker.addListener('click', function () {
                                closeInfoWindows();
                                infowindow.open(map, marker);
                            });

                            infowindows.push(infowindow);
                        } else {
                            console.log('Geocode was not successful for the following reason: ' + status);
                        }
                    });
                });
            });

            function closeInfoWindows() {
                infowindows.forEach(function (window) {
                    window.close();
                });
            }
        }
    </script>
</head>
<body>
    <div id="map"></div>
</body>
</html>
