<!DOCTYPE html>
<html>
<head>
  <title>Mapa com Marcadores</title>
  <style>
    /* Definir a altura da div 'map' para ocupar 100% da altura da janela */
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-database.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_DqAfjDQHOGESUrUboqiVYv0qGa1WeJc&callback=initMap" async defer></script>
  <script>
    var map;
    var infowindows = [];

    function initMap() {
      var geocoder = new google.maps.Geocoder();

      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: -22.480796, lng: -47.451883 },
        zoom: 14
      });

      // Inicializar o Firebase com sua configuração
      const firebaseConfig = {
        apiKey: "AIzaSyAdUfTSjOesN3a_7ajFa1BAJjIass9h6L0",
  authDomain: "redireciona-bf04a.firebaseapp.com",
  databaseURL: "https://redireciona-bf04a-default-rtdb.firebaseio.com",
  projectId: "redireciona-bf04a",
  storageBucket: "redireciona-bf04a.appspot.com",
  messagingSenderId: "95966901521",
  appId: "1:95966901521:web:2d0b8b20dbb1c356d688b0",
  measurementId: "G-Z3LV16X6Y4"
      };

      firebase.initializeApp(firebaseConfig);

      const locationsRef = firebase.database().ref('locations');

      var bounds = new google.maps.LatLngBounds(); // Cria um objeto para guardar os limites do mapa

      locationsRef.on('value', (snapshot) => {
        snapshot.forEach((locationSnapshot) => {
          var location = locationSnapshot.val(); // Acessar os valores dos nós

          geocoder.geocode({ 'address': location.address }, function (results, status) {
            if (status === 'OK') {
              var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location,
                title: location.name,
              });

              var infowindow = new google.maps.InfoWindow({
                content: location.name + "<br>" + location.address
              });

              // Abre o infowindow automaticamente quando o marcador é adicionado ao mapa
              infowindow.open(map, marker);

              marker.addListener('click', function () {
                closeInfoWindows();
                infowindow.open(map, marker);
              });

              infowindows.push(infowindow);

              // Expande os limites do mapa para incluir a posição do marcador
              bounds.extend(results[0].geometry.location);
            } else {
              console.log('Geocode was not successful for the following reason: ' + status);
            }

            // Ajusta o zoom e a posição do mapa para que todos os marcadores fiquem visíveis
            map.fitBounds(bounds);
          });
        });
      });

      function closeInfoWindows() {
        infowindows.forEach(function (window) {
          window.close();
        });
      }
    }
  </script>
</body>
</html>
