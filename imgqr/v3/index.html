<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Ler QRCodes e ver links</title>
    <style>
      #preview {
        max-height: 80vh;
        width: 100%;
      }
      #preview-container {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 56.25%;
      }
      #result {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Leitor de QR Code</h1>
    <div id="preview-container">
      <video id="preview"></video>
    </div>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

    <div id="table-container">
      <table id="qrTable">
        <tr>
          <th>QR Code</th>
          <th>Data/Hora</th>
        </tr>
      </table>
    </div>
    <div id="result"></div>
    <script src="https://unpkg.com/@zxing/library@0.18.5"></script>
    <script>
      const video = document.getElementById('preview');
      const resultContainer = document.getElementById('result');
      const qrTable = document.getElementById('qrTable');
      const codeReader = new ZXing.BrowserQRCodeReader();
      const qrHistory = [];

      codeReader.getVideoInputDevices()
        .then(videoInputDevices => {
          const rearCamera = videoInputDevices.find(device => device.label.toLowerCase().includes('back'));
          if (rearCamera) {
            codeReader.decodeFromVideoDevice(rearCamera.deviceId, 'preview', (result, err) => {
              if (result) {
                resultContainer.innerHTML = `<a href="${result.text}" target="_blank">${result.text}</a>`;
                qrHistory.push({text: result.text, date: new Date().toLocaleString()});
                const tableRow = document.createElement('tr');
                const qrDataCell = document.createElement('td');
                const dateCell = document.createElement('td');
                qrDataCell.innerText = result.text;
                dateCell.innerText = new Date().toLocaleString();
                tableRow.appendChild(qrDataCell);
                tableRow.appendChild(dateCell);
                qrTable.appendChild(tableRow);
              }
              if (err && !(err instanceof ZXing.NotFoundException)) {
                console.error(err);
              }
            });
          } else {
            alert('Câmera traseira não encontrada!');
          }
        })
        .catch(err => console.error(err));
    </script>
  </body>
</html>
